function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var ss = SpreadsheetApp.getActiveSpreadsheet();
    var sheet = ss.getSheetByName("الورقة1");
    
    // حفظ المرفق
    var fileBlob = Utilities.newBlob(Utilities.base64Decode(data.fileData.split(",")[1]), "image/png", data.fileName);
    var file = DriveApp.getRootFolder().createFile(fileBlob);
    file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
    var fileUrl = file.getUrl();

    // إدراج صف في الأعلى
    sheet.insertRowBefore(2);
    
    var rowData = [
      new Date(),         // A
      data.nationalID,    // B
      data.fullIdentity,  // C
      data.phone,         // D
      data.address,       // E
      data.summary,       // F
      "",                 // G (فراغ)
      fileUrl,            // H
      data.suggestion,    // I (هنا المقترح أو الفكرة الجديدة)
      "قيد المراجعة",     // J
      ""                  // K (بواسطة)
    ];
    
    sheet.getRange(2, 1, 1, rowData.length).setValues([rowData]);
    
    return out(JSON.stringify({status: "success"}));
  } catch (err) {
    return out(JSON.stringify({status: "error", message: err.toString()}));
  }
}
